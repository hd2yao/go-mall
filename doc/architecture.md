# 系统架构文档

## 整体架构

### 系统架构图（待完善）

```Plain Text
+------------------+     +------------------+     +------------------+
|                  |     |                  |     |                  |
|   Web/Mobile     |     |   API Gateway    |     |   Load Balancer  |
|     Client       |<--->|     (Nginx)      |<--->|    (Nginx)       |
|                  |     |                  |     |                  |
+------------------+     +------------------+     +--------^---------+
                                                          |
                                                          |
                        +-----------------------------+   |
                        |                             |   |
                        |        go-mall Service      |   |
                        |                             |   |
                        +-----------------------------+   |
                                     |                   |
                                     |                   |
              +---------------------+ | +----------------+|
              |                     | | |                |
        +-----v------+      +------v-v-v---+    +-------v------+
        |            |      |              |    |              |
        |   MySQL    |      |    Redis     |    |  Monitoring  |
        |            |      |              |    |              |
        +------------+      +--------------+    +--------------+
```

## 技术栈

### 后端技术

1. 核心框架
   - Go 1.20
   - Gin Web 框架
   - GORM ORM 框架

2. 数据存储
   - MySQL 8.0+
   - Redis 6.0+

3. 中间件（待完善）
   - Nginx：负载均衡、反向代理
   - Redis：缓存、会话管理

4. 监控和日志
   - Zap：日志框架
   - Prometheus：性能监控
   - Grafana：可视化监控

### 开发工具

1. 开发环境
   - GoLand/Cursor
   - Git
   - Docker

2. 测试工具
   - Go testing
   - GoMock
   - Postman

## 系统分层

### 1. 表现层 (API Layer)

```Plain Text
api/
├── controller/    # 控制器
├── middleware/    # 中间件
├── request/      # 请求对象
├── reply/        # 响应对象
└── router/       # 路由配置
```

主要职责：

- HTTP 请求处理
- 参数验证
- 权限控制
- 响应封装

### 2. 业务层 (Logic Layer)

```Plain Text
logic/
├── appservice/       # 业务服务
├── do/               # 数据传输对象
└── domainservice/    # 业务具体实现
```

主要职责：

- 业务逻辑处理
- 事务管理
- 数据校验
- 领域对象转换

### 3. 数据访问层 (DAL Layer)

```Plain Text
dal/
├── model/        # 数据模型
├── dao/          # 数据访问对象
└── cache/        # 缓存操作
```

主要职责：

- 数据库操作
- 缓存操作
- 数据模型定义

### 4. 基础设施层 (Infrastructure Layer)

```Plain Text
common/          # 公共组件
config/          # 配置管理
library/         # 工具库
storage/         # 存储服务
```

主要职责：

- 配置管理
- 工具函数
- 基础服务
- 存储服务

## 核心流程

### 1. 请求处理流程

1. 客户端发起请求
2. Nginx 负载均衡
3. API Gateway 处理
4. 路由分发
5. 中间件处理
   - 日志记录
   - 认证授权
   - 参数验证
6. 控制器处理
7. 业务逻辑处理
8. 数据访问
9. 响应返回

### 2. 数据处理流程

1. 缓存查询
2. 数据库操作
3. 数据组装
4. 数据转换
5. 响应封装

## 安全架构

### 1. 接入层安全

- HTTPS 加密
- API Gateway 防护
- DDoS 防护
- WAF 防护

### 2. 应用层安全

- JWT 认证
- 权限控制
- 参数验证
- SQL 注入防护
- XSS 防护

### 3. 数据层安全

- 数据加密
- 敏感数据脱敏
- 数据备份
- 访问控制

## 高可用设计（待优化）

### 1. 负载均衡

- Nginx 负载均衡
- 多实例部署
- 会话共享

### 2. 数据库高可用

- 主从复制
- 读写分离
- 分库分表

### 3. 缓存高可用

- Redis 集群
- 多级缓存
- 缓存预热

### 4. 容灾备份

- 多机房部署
- 数据备份
- 故障转移

## 性能优化

### 1. 应用层优化

- 连接池管理
- 协程池管理
- 本地缓存
- 异步处理

### 2. 数据库优化

- 索引优化
- SQL 优化
- 分库分表
- 读写分离

### 3. 缓存优化

- 多级缓存
- 缓存预热
- 缓存更新策略
- 缓存穿透防护

## 监控告警

### 1. 系统监控

- CPU 使用率
- 内存使用率
- 磁盘使用率
- 网络流量

### 2. 应用监控

- QPS
- 响应时间
- 错误率
- 并发数

### 3. 业务监控

- 订单量
- 支付量
- 用户活跃度
- 商品库存

### 4. 告警策略

- 监控指标告警
- 错误日志告警
- 业务异常告警
- 安全事件告警
